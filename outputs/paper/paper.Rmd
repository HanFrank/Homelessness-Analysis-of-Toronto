---
title: "An Analysis of Homelessness in Toronto in regards to COVID-19 and other factors"
subtitle: "Data from January 2020 to December 2021"
author: "Ziyao Han"
thanks: "Code and data are available at: https://github.com/HanFrank/STA304-Paper-1"
date: "February 6, 2022"
abstract: "First sentence. Second sentence. Third sentence. Fourth sentence."
output: 
  bookdown::pdf_document2:
    extra_dependencies: ["float"]
toc: TRUE
bibliography: references.bib
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
library(dplyr)
library(knitr)
library(bookdown)
library(kableExtra)
library(ggplot2)

# Grabbing dataset
monthly_shelter_usage <- read_csv(here::here("inputs/data/shelter_flow_data.csv"))

# removing id generated by read_csv
monthly_shelter_usage <- monthly_shelter_usage[-c(1)]
```

# Introduction

First Paragraph is going to be motivational and broad.
importance of homelessness shelters for a city

Second Paragraph is about what was done and what was found.


Third paragraph is about implications.
covid19 has changed the way the world works
- social distancing
- mask requirements
- vaccines


The statistical analysis in this report will be done using `R` [@citeR]. The R Packages, `tidyverse` [@citetidy] and `dplyr` [@citedplyr] will be used for data manipulation and cleaning. The graphs and tables for this report will created and formatted with `ggplot2` [@citeggplot] and `kableExtra` [@citekable]. The packages `bookdown` [@citebookdown] and `knitr` [@citeknitr] will be used to format this report.

\newpage

# Data

## Data Source

The data that was used for this report was obtained and gathered by the Shelter, Support & Housing Administration (SSHA) of the City of Toronto [@citedata]. This data is collected through the City of Toronto funded homelessness shelters and services. This data shares information about the people accessing the services and is meant to provide insight regarding homelessness in Toronto with the vision of reducing homelessness in the city. This dataset is openly available to the public through the City of Toronto's Open Data Portal on an Open Government License - Toronto and was accessed through R using the R package `opendatatoronto` [@citeodt]. This dataset contains data from January 2020 to December 2021 and was last updated on January 7th, 2022. 


## Methodology and Data Collection

The Shelter, Support & Housing Administration Division of the City of Toronto is the governmental service operator and manager of housing and homelessness services in Toronto. They offer services such as emergency shelters, street outreach, short-term respites and housing stability services such as drop-ins and eviction prevention [@citeshelter]. The Shelter System Flow data records the number of unique people who are entering and leaving the shelter system each month. In the data, the number of actively homeless is determined as the number people whom have used the shelter services within the past three months.

## Data Limitations

Since the data is collected from people accessing the homelessness services operated or managed by the City of Toronto, this data does not contain people who have been used these services such as people sleeping exclusively outdoors or using other homelessness services that are not using the Shelter Management Information System (SMIS). According to the dataset, based on a recent Street Needs Assessment (A city-wide count and survey of people experiencing homelessness in Toronto [@citesna]), there is an anticipated 18 per cent of people experiencing homelessness in Toronto that is not reflected in this dataset [@citedata].

There is a variety of reasons a person experiencing homelessness will not seek help from a shelter system. Example of this could be to avoid shelter restrictions such as curfews. Another potential reason, especially during the Covid-19 pandemic, is public health concerns [@citepallet]. This specific topic will be discussed further in section \@ref(covid).

## Data Characteristics

The original dataset contained 180 observations with 18 variables. These 180 observations are comprised of 7 categorical entries per month for 24 months (168 observations) and starting from January 2021, an additional entry was added per month for peoples identifying as Indigenous for an additional 12 observations (totaling 180). For the data cleaning process, variables that are outside of the scope of the report were removed as well as variables that had no potential usage for analysis. The id variable variable was removed due to no potential usage and the 5 age demographic variables were removed because they were outside of the scope for this report and I felt that the Youth categorical observations serve a similar but better statistical purpose. Lastly, I converted the date variable from an (mmm-yy) character into a date format for easier data manipulation and graph creation. This was done using code referenced from [@citeyarna] in the RStudio Community forum. 

Here is an extract of the dataset from January 2020, with a few sample of variables of interest (Table \@ref(tab:extract)).

```{r extract, echo = FALSE, warning = FALSE, message = FALSE}
# Showing an extract of the total dataset as a sample
monthly_shelter_usage %>%
  select(date, population_group, actively_homeless, population_group_percentage) %>%
  slice(1:7) %>%
  kable(
    caption = "Extract from full dataset, January 2020",
    col.names = c("Date", "Population Group", "Actively Homeless", "Percentage of Group Population"),
    digits = 1,
    booktabs = TRUE,
    linesep=""
  )
```

As seen, since the cleaned dataset uses the date format, 2020-01-01 represents January, 2020. Moreover, for example, 2021-08-01 would represents August, 2021.

# Data Accessment and Discussion

## Covid-19 and its effects on homelessness shelter usage {#covid}

```{r graph1, fig.cap="Active number of homeless over time", echo=FALSE, fig.height=4, fig.width=6}
# Creating subset of only total population
total_population <- monthly_shelter_usage[monthly_shelter_usage$population_group == "All Population",]
# Plotting total usage of homeless shelter over time and overlaying start of covid
ggplot(total_population, aes(x = date, y = actively_homeless)) +
geom_line() +
# Drawing dotted red line for covid
geom_line(aes(x=as.Date("2020-03-01"), col = "COVID-19 response begins in Toronto"), linetype="dotted") + 
labs(x = "Date", 
     y = "Actively Homeless", 
     title =  "Usage of Homeless shelters dropping due to COVID-19",
     col = "Event: ") +
theme_minimal() +
theme(legend.position = "bottom")
```

Stuff about this graph

### Chronic shelter usage is stable

```{r graph2, fig.cap="Active number of homeless over time for each population group", echo=FALSE}
ggplot(monthly_shelter_usage, mapping = aes(x = date, y = actively_homeless, colour = population_group)) +
geom_line() +
labs(x = "Date", 
     y = "Actively Homeless", 
     title =  "Chronic shelter usage remains stable through COVID-19",
     caption = "Began tracking Indigenous numbers in Jan 2021",) +
theme_minimal()
```

## Gender demographics

```{r gendertable, echo = FALSE, fig.cap="Active Homeless by Gender"}
# Creating empty tibble for gender
gender_table <- tibble("Gender" = character(),
                       "Total" = numeric(),
                       "Percentage" = numeric())

# Populating dataframe
gender_table <- add_row(gender_table, 
                        Gender = "Male", 
                        Total = sum(total_population$gender_male), 
                        Percentage = round(sum(total_population$gender_male) / sum(total_population$actively_homeless) * 100, digits = 1))


gender_table <- add_row(gender_table, 
                        Gender = "Female", 
                        Total = sum(total_population$gender_female),
                        Percentage = round(sum(total_population$gender_female) / sum(total_population$actively_homeless) * 100, digits = 1))


gender_table <- add_row(gender_table,
                        Gender = "Transgender, Non-binary or Two-spirit", 
                        Total = sum(total_population$`gender_transgender,non-binary_or_two_spirit`), 
                        Percentage = round(sum(total_population$`gender_transgender,non-binary_or_two_spirit`) / sum(total_population$actively_homeless) * 100, digits = 1))

# Creating kable
gender_table %>% 
  kable(
    caption = "Table of shelter usage by gender",
    digits = 1,
    booktabs = TRUE,
    linesep=" ",
  ) %>% 
    add_footnote("Percentage Â± 0.1", notation = "number") # Adding rounding error
```
## Movement to Permanant

```{r, fig.cap="Movement between Permanant housing", echo=FALSE}
ggplot(total_population, aes(x = date)) +
geom_line(aes(y = moved_to_housing, col = "Moved")) +
geom_line(aes(y = returned_from_housing, col = "Returned")) + 
# Drawing dotted red line for covid
labs(x = "Date", 
     y = "# of people", 
     title =  "People moving to permanant housing dropping significantly",
     col = "Action: ") +
theme_minimal() +
theme(legend.position = "bottom")
```


## Areas of potential further exploration

Weaknesses and next steps should also be included.

# Conclusion

\newpage

# References

Articles that need to be used and referenced in discussion
https://toronto.citynews.ca/2021/03/11/timeline-a-year-of-pandemic-life/
https://www.facetsjournal.com/doi/10.1139/facets-2021-0004
https://www.cbc.ca/news/canada/toronto/toronto-shelters-in-outbreak-unhoused-people-one-death-covid-19-1.6003201


